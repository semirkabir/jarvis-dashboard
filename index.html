<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis Task Request Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            padding: 2rem;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #334155;
        }
        .header h1 { font-size: 1.8rem; color: #60a5fa; }
        .last-updated { color: #94a3b8; font-size: 0.9rem; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: #1e293b;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #334155;
        }
        .stat-card h3 {
            font-size: 0.85rem;
            color: #94a3b8;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #e2e8f0;
        }
        .stat-card .stat-sub {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 0.25rem;
        }
        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        @media (max-width: 768px) {
            .charts-section { grid-template-columns: 1fr; }
        }
        .chart-card {
            background: #1e293b;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #334155;
        }
        .chart-card h2 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #e2e8f0;
        }
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .bar-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .bar-label {
            min-width: 100px;
            font-size: 0.85rem;
            color: #94a3b8;
        }
        .bar-track {
            flex: 1;
            height: 32px;
            background: #0f172a;
            border-radius: 6px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            border-radius: 6px;
            transition: width 0.3s ease;
        }
        .requests-list {
            background: #1e293b;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #334155;
        }
        .requests-list h2 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #e2e8f0;
        }
        .request-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            background: #0f172a;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 3px solid;
        }
        .request-item .emoji { font-size: 1.5rem; }
        .request-item .content { flex: 1; }
        .request-item .text {
            font-size: 0.95rem;
            color: #e2e8f0;
            margin-bottom: 0.25rem;
        }
        .request-item .meta {
            font-size: 0.75rem;
            color: #64748b;
        }
        .request-item.completed { border-left-color: #22c55e; }
        .request-item.pending { border-left-color: #f59e0b; }
        .insights {
            background: #1e293b;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #334155;
            margin-top: 1.5rem;
        }
        .insights h2 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #60a5fa;
        }
        .insight-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem 0;
            color: #94a3b8;
            font-size: 0.9rem;
        }
        .insight-item .emoji { font-size: 1.2rem; }
        .no-data {
            text-align: center;
            padding: 3rem;
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Jarvis Task Request Dashboard</h1>
            <div class="last-updated" id="lastUpdated">Loading...</div>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <h3>Total Requests</h3>
                <div class="value" id="totalRequests">0</div>
                <div class="stat-sub">All time</div>
            </div>
            <div class="stat-card">
                <h3>This Week</h3>
                <div class="value" id="weekRequests">0</div>
                <div class="stat-sub">Last 7 days</div>
            </div>
            <div class="stat-card">
                <h3>Avg Response</h3>
                <div class="value" id="avgResponse">--</div>
                <div class="stat-sub">Estimated time</div>
            </div>
            <div class="stat-card">
                <h3>Top Category</h3>
                <div class="value" id="topCategory">--</div>
                <div class="stat-sub" id="topCategoryCount">-- requests</div>
            </div>
        </div>

        <div class="charts-section">
            <div class="chart-card">
                <h2>üìä Requests by Category</h2>
                <div class="bar-chart" id="categoryChart"></div>
            </div>
            <div class="chart-card">
                <h2>‚è∞ Activity by Time (PST)</h2>
                <div class="bar-chart" id="timeChart"></div>
            </div>
        </div>

        <div class="requests-list">
            <h2>üìã Recent Requests</h2>
            <div id="requestsList"></div>
        </div>

        <div class="insights">
            <h2>üí° Insights</h2>
            <div id="insightsList"></div>
        </div>
    </div>

    <script>
        // Color schemes for categories
        const categoryColors = {
            'üìà Analysis': { bg: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', text: '#ecfdf5' },
            '‚úçÔ∏è Writing': { bg: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)', text: '#eff6ff' },
            'üîß Technical': { bg: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)', text: '#f5f3ff' },
            'üìÖ Reminders': { bg: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)', text: '#fffbeb' },
            'üß† Research': { bg: 'linear-gradient(135deg, #ec4899 0%, #db2777 100%)', text: '#fdf2f8' },
            'üí¨ Conversation': { bg: 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)', text: '#eef2ff' },
            'üí∞ Markets': { bg: 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)', text: '#f0fdfa' },
            'üè• Heartbeat': { bg: 'linear-gradient(135deg, #64748b 0%, #475569 100%)', text: '#f1f5f9' }
        };

        function loadData() {
            fetch('request-log.json?t=' + Date.now())
                .then(response => response.json())
                .then(data => {
                    renderDashboard(data);
                    document.getElementById('lastUpdated').textContent =
                        'Updated: ' + new Date(data.lastUpdated * 1000).toLocaleString('en-US', {
                            timeZone: 'America/Los_Angeles'
                        }) + ' PST';
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    renderEmptyDashboard();
                });
        }

        function renderEmptyDashboard() {
            document.getElementById('totalRequests').textContent = '0';
            document.getElementById('weekRequests').textContent = '0';
            document.getElementById('categoryChart').innerHTML = '<div class="no-data">No requests logged yet</div>';
            document.getElementById('timeChart').innerHTML = '<div class="no-data">No time data yet</div>';
            document.getElementById('requestsList').innerHTML = '<div class="no-data">Requests will appear here</div>';
            document.getElementById('insightsList').innerHTML = '<div class="insight-item">Start assigning tasks to Jarvis to see patterns!</div>';
            document.getElementById('lastUpdated').textContent = 'No data yet';
        }

        function renderDashboard(data) {
            const requests = data.requests || [];

            // Stats
            const total = requests.length;
            const oneWeekAgo = (Date.now() / 1000) - (7 * 24 * 60 * 60);
            const weekCount = requests.filter(r => r.timestamp >= oneWeekAgo).length;

            document.getElementById('totalRequests').textContent = total;
            document.getElementById('weekRequests').textContent = weekCount;
            document.getElementById('avgResponse').textContent = '~2m';

            // Category counts
            const categoryCounts = {};
            requests.forEach(r => {
                categoryCounts[r.category] = (categoryCounts[r.category] || 0) + 1;
            });

            const sortedCategories = Object.entries(categoryCounts).sort((a, b) => b[1] - a[1]);
            const topCat = sortedCategories[0];
            if (topCat) {
                document.getElementById('topCategory').textContent = topCat[0].split(' ')[1] || topCat[0];
                document.getElementById('topCategoryCount').textContent = topCat[1] + ' requests';
            }

            // Category chart
            const maxCatCount = Math.max(...Object.values(categoryCounts), 1);
            const categoryChart = document.getElementById('categoryChart');
            categoryChart.innerHTML = sortedCategories.map(([cat, count]) => {
                const pct = (count / maxCatCount) * 100;
                const colors = categoryColors[cat] || { bg: '#64748b', text: '#e2e8f0' };
                return `
                    <div class="bar-row">
                        <div class="bar-label">${cat}</div>
                        <div class="bar-track">
                            <div class="bar-fill" style="width: ${pct}%; background: ${colors.bg}; color: ${colors.text}">
                                ${count}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Time distribution (by hour, PST)
            const timeCounts = Array(24).fill(0);
            requests.forEach(r => {
                const pstDate = new Date((r.timestamp - 8 * 3600) * 1000);
                const hour = pstDate.getHours();
                timeCounts[hour]++;
            });
            const maxTimeCount = Math.max(...timeCounts, 1);
            const timeChart = document.getElementById('timeChart');
            timeChart.innerHTML = timeCounts.map((count, hour) => {
                if (count === 0) return '';
                const pct = (count / maxTimeCount) * 100;
                const period = hour >= 12 ? 'PM' : 'AM';
                const displayHour = hour % 12 || 12;
                return `
                    <div class="bar-row">
                        <div class="bar-label">${displayHour} ${period}</div>
                        <div class="bar-track">
                            <div class="bar-fill" style="width: ${pct}%; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: #eef2ff">
                                ${count}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Recent requests list
            const recent = requests.slice(-10).reverse();
            document.getElementById('requestsList').innerHTML = recent.length === 0
                ? '<div class="no-data">No requests yet</div>'
                : recent.map(r => {
                    const colors = categoryColors[r.category] || { bg: '#64748b', text: '#e2e8f0' };
                    const pstDate = new Date((r.timestamp - 8 * 3600) * 1000);
                    return `
                        <div class="request-item ${r.status}">
                            <div class="emoji">${r.category.split(' ')[0]}</div>
                            <div class="content">
                                <div class="text">${r.text}</div>
                                <div class="meta">${r.category} ‚Ä¢ ${pstDate.toLocaleString('en-US', {
                                    month: 'short',
                                    day: 'numeric',
                                    hour: 'numeric',
                                    minute: '2-digit',
                                    timeZone: 'America/Los_Angeles'
                                })} PST</div>
                            </div>
                        </div>
                    `;
                }).join('');

            // Insights
            const insights = generateInsights(requests, categoryCounts, timeCounts);
            document.getElementById('insightsList').innerHTML = insights.map(i => `
                <div class="insight-item">
                    <span class="emoji">${i.emoji}</span>
                    <span>${i.text}</span>
                </div>
            `).join('');
        }

        function generateInsights(requests, categoryCounts, timeCounts) {
            const insights = [];
            const total = requests.length;
            if (total === 0) {
                return [{ emoji: 'üéØ', text: 'Start assigning tasks to Jarvis to see patterns!' }];
            }

            // Most active time
            const maxHour = timeCounts.indexOf(Math.max(...timeCounts));
            const period = maxHour >= 12 ? 'PM' : 'AM';
            const displayHour = maxHour % 12 || 12;
            if (timeCounts[maxHour] > 0) {
                insights.push({
                    emoji: '‚è∞',
                    text: `Most active time: ${displayHour} ${period} PST (${timeCounts[maxHour]} requests)`
                });
            }

            // Top category
            const sortedCats = Object.entries(categoryCounts).sort((a, b) => b[1] - a[1]);
            if (sortedCats.length > 0) {
                const topCatPct = Math.round((sortedCats[0][1] / total) * 100);
                insights.push({
                    emoji: 'üìä',
                    text: `Top category: ${sortedCats[0][0].split(' ')[1]} (${topCatPct}% of requests)`
                });
            }

            // Completion rate
            const completed = requests.filter(r => r.status === 'completed').length;
            const completionRate = Math.round((completed / total) * 100);
            insights.push({
                emoji: '‚úÖ',
                text: `Completion rate: ${completionRate}% (${completed}/${total} completed)`
            });

            // Activity level
            if (total >= 20) {
                insights.push({ emoji: 'üî•', text: 'You\'re a power user! High engagement this week.' });
            } else if (total >= 10) {
                insights.push({ emoji: 'üìà', text: 'Good activity! Keep the requests coming.' });
            } else {
                insights.push({ emoji: 'üí°', text: 'Try using Jarvis more to unlock deeper insights.' });
            }

            return insights;
        }

        // Load data on page load and refresh every 30 seconds
        loadData();
        setInterval(loadData, 30000);
    </script>
</body>
</html>
