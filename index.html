<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis Mission Control</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            background: #0a0e17;
            color: #e2e8f0;
            padding: 1rem;
            line-height: 1.5;
        }
        .container { max-width: 1600px; margin: 0 auto; }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 8px;
            border: 1px solid #334155;
        }
        .header-left { display: flex; align-items: center; gap: 1rem; }
        .status-dot {
            width: 12px; height: 12px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            50% { opacity: 0.7; box-shadow: 0 0 0 8px rgba(34, 197, 94, 0); }
        }
        .header h1 {
            font-size: 1.4rem;
            color: #60a5fa;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .header-right { text-align: right; }
        .uptime { color: #94a3b8; font-size: 0.85rem; }
        .last-sync { color: #64748b; font-size: 0.75rem; }

        /* Mission Control Grid */
        .mc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        @media (max-width: 1200px) { .mc-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .mc-grid { grid-template-columns: 1fr; } }

        /* Panels */
        .panel {
            background: #111827;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #1f2937;
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #1f2937;
        }
        .panel-title {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .panel-badge {
            font-size: 0.65rem;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            background: #1f2937;
            color: #64748b;
        }
        .panel-badge.active { background: #22c55e; color: #064e3b; }
        .panel-badge.warning { background: #f59e0b; color: #78350f; }
        .panel-badge.error { background: #ef4444; color: #7f1d1d; }

        /* Status Indicators */
        .status-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #1f2937;
        }
        .status-row:last-child { border-bottom: none; }
        .status-label { font-size: 0.85rem; color: #e2e8f0; }
        .status-value { font-size: 0.85rem; font-weight: 600; }
        .status-value.online { color: #22c55e; }
        .status-value.offline { color: #ef4444; }
        .status-value.pending { color: #f59e0b; }

        /* Metric Cards */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        .metric-card {
            background: #1e293b;
            padding: 0.75rem;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
        }
        .metric-card.success { border-left-color: #22c55e; }
        .metric-card.warning { border-left-color: #f59e0b; }
        .metric-card.danger { border-left-color: #ef4444; }
        .metric-label { font-size: 0.7rem; color: #64748b; text-transform: uppercase; }
        .metric-value { font-size: 1.25rem; font-weight: 700; color: #e2e8f0; }
        .metric-sub { font-size: 0.7rem; color: #64748b; margin-top: 0.25rem; }

        /* Activity Timeline */
        .timeline { max-height: 300px; overflow-y: auto; }
        .timeline-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.5rem 0;
            border-left: 2px solid #1f2937;
            padding-left: 1rem;
            margin-left: 0.5rem;
            position: relative;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 0.6rem;
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
        }
        .timeline-item.completed::before { background: #22c55e; }
        .timeline-item.pending::before { background: #f59e0b; }
        .timeline-item.error::before { background: #ef4444; }
        .timeline-time { font-size: 0.7rem; color: #64748b; min-width: 70px; }
        .timeline-content { flex: 1; }
        .timeline-text { font-size: 0.85rem; color: #e2e8f0; }
        .timeline-meta { font-size: 0.7rem; color: #64748b; margin-top: 0.25rem; }

        /* Cron Job List */
        .cron-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            background: #1e293b;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        .cron-icon { font-size: 1.2rem; }
        .cron-info { flex: 1; }
        .cron-name { font-size: 0.85rem; color: #e2e8f0; font-weight: 600; }
        .cron-schedule { font-size: 0.7rem; color: #64748b; }
        .cron-status {
            font-size: 0.65rem;
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
            background: #22c55e;
            color: #064e3b;
        }
        .cron-status.inactive { background: #64748b; color: #f1f5f9; }

        /* Alerts Panel */
        .alert-item {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #1e293b;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            border-left: 3px solid;
        }
        .alert-item.critical { border-left-color: #ef4444; background: #1f1d1d; }
        .alert-item.warning { border-left-color: #f59e0b; }
        .alert-item.info { border-left-color: #3b82f6; }
        .alert-icon { font-size: 1rem; }
        .alert-text { font-size: 0.8rem; color: #e2e8f0; }
        .alert-time { font-size: 0.65rem; color: #64748b; }

        /* Quick Actions */
        .quick-actions { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .quick-btn {
            font-family: inherit;
            font-size: 0.75rem;
            padding: 0.4rem 0.75rem;
            background: #1e293b;
            color: #e2e8f0;
            border: 1px solid #374151;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quick-btn:hover { background: #334155; border-color: #475569; }
        .quick-btn.primary { background: #3b82f6; border-color: #2563eb; color: #fff; }
        .quick-btn.primary:hover { background: #2563eb; }
        .quick-btn.danger { background: #ef4444; border-color: #dc2626; color: #fff; }
        .quick-btn.danger:hover { background: #dc2626; }

        /* Category Pills */
        .category-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            background: #1e293b;
            color: #e2e8f0;
        }
        .category-pill::before {
            content: '';
            width: 8px; height: 8px;
            border-radius: 50%;
        }
        .category-pill.analysis::before { background: #10b981; }
        .category-pill.writing::before { background: #3b82f6; }
        .category-pill.technical::before { background: #8b5cf6; }
        .category-pill.reminders::before { background: #f59e0b; }
        .category-pill.research::before { background: #ec4899; }
        .category-pill.conversation::before { background: #6366f1; }
        .category-pill.markets::before { background: #14b8a6; }
        .category-pill.heartbeat::before { background: #64748b; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #475569;
        }
        .empty-state .icon { font-size: 2rem; margin-bottom: 0.5rem; }

        /* Progress Bar */
        .progress-bar {
            height: 4px;
            background: #1f2937;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.25rem;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="status-dot" id="systemStatus"></div>
                <h1>ü§ñ Jarvis Mission Control</h1>
            </div>
            <div class="header-right">
                <div class="uptime" id="uptime">Uptime: --</div>
                <div class="last-sync" id="lastSync">Last sync: --</div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="mc-grid">
            <!-- System Status Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">‚ö° System Status</div>
                    <span class="panel-badge active">ONLINE</span>
                </div>
                <div id="systemStatusList"></div>
            </div>

            <!-- Quick Stats Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">üìä Quick Stats</div>
                    <span class="panel-badge" id="statCount">0 requests</span>
                </div>
                <div class="metric-grid" id="quickStats"></div>
            </div>

            <!-- Category Distribution Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">üìà Categories</div>
                    <span class="panel-badge" id="topCategoryBadge">--</span>
                </div>
                <div id="categoryList"></div>
            </div>

            <!-- Cron Jobs Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">‚è∞ Active Cron Jobs</div>
                    <span class="panel-badge active" id="cronCount">3 active</span>
                </div>
                <div id="cronList"></div>
            </div>
        </div>

        <!-- Second Row -->
        <div class="mc-grid">
            <!-- Recent Activity Timeline -->
            <div class="panel" style="grid-column: span 2;">
                <div class="panel-header">
                    <div class="panel-title">üìã Activity Timeline</div>
                    <span class="panel-badge">Live</span>
                </div>
                <div class="timeline" id="timeline"></div>
            </div>

            <!-- Alerts Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">üö® Alerts</div>
                    <span class="panel-badge" id="alertCount">0</span>
                </div>
                <div id="alertsList"></div>
            </div>

            <!-- Quick Actions Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">‚ö° Quick Actions</div>
                </div>
                <div class="quick-actions">
                    <button class="quick-btn primary" onclick="location.reload()">üîÑ Refresh</button>
                    <button class="quick-btn" onclick="window.open('https://github.com/semirkabir/jarvis-dashboard', '_blank')">üìÇ Repo</button>
                    <button class="quick-btn" onclick="exportData()">üì• Export</button>
                    <button class="quick-btn" onclick="clearAlerts()">üßπ Clear Alerts</button>
                </div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: #1e293b; border-radius: 6px;">
                    <div style="font-size: 0.7rem; color: #64748b; margin-bottom: 0.5rem;">DAILY STREAK</div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: #22c55e;" id="streak">0 days</div>
                </div>
            </div>
        </div>

        <!-- Third Row - Detailed Charts -->
        <div class="panel" style="margin-top: 1rem;">
            <div class="panel-header">
                <div class="panel-title">üìä Activity by Hour (PST)</div>
                <span class="panel-badge">Last 7 days</span>
            </div>
            <div id="hourlyChart" style="display: flex; align-items: flex-end; gap: 4px; height: 100px; padding: 1rem 0;"></div>
        </div>
    </div>

    <script>
        // System data
        const systemStatus = [
            { name: 'Gateway', value: 'Online', class: 'online' },
            { name: 'Moltbook API', value: 'Connected', class: 'online' },
            { name: 'Telegram Bot', value: 'Active', class: 'online' },
            { name: 'Database', value: 'Synced', class: 'online' },
            { name: 'Cron System', value: 'Running', class: 'online' }
        ];

        const cronJobs = [
            { name: 'Nightly Build', icon: 'üèóÔ∏è', schedule: 'Daily 3 AM PST', status: 'active' },
            { name: 'Market Report', icon: 'üìä', schedule: 'Daily 9 AM PST', status: 'active' },
            { name: 'Auto-Update', icon: 'üîÑ', schedule: 'Daily 11 PM PST', status: 'active' },
            { name: 'Heartbeat Check', icon: 'üíì', schedule: 'Every 4 hours', status: 'active' }
        ];

        function loadData() {
            fetch('request-log.json?t=' + Date.now())
                .then(response => response.json())
                .then(data => {
                    renderDashboard(data);
                    updateLastSync(data.lastUpdated);
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    renderEmptyDashboard();
                });
        }

        function updateLastSync(timestamp) {
            if (timestamp) {
                const date = new Date(timestamp * 1000);
                document.getElementById('lastSync').textContent =
                    'Last sync: ' + date.toLocaleString('en-US', {
                        timeZone: 'America/Los_Angeles'
                    }) + ' PST';
            }
        }

        function renderEmptyDashboard() {
            document.getElementById('systemStatusList').innerHTML =
                systemStatus.map(s => `
                    <div class="status-row">
                        <span class="status-label">${s.name}</span>
                        <span class="status-value ${s.class}">${s.value}</span>
                    </div>
                `).join('');

            document.getElementById('quickStats').innerHTML = `
                <div class="metric-card">
                    <div class="metric-label">Total Requests</div>
                    <div class="metric-value">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">This Week</div>
                    <div class="metric-value">0</div>
                </div>
            `;

            document.getElementById('categoryList').innerHTML =
                '<div class="empty-state"><div class="icon">üì≠</div>No data yet</div>';

            document.getElementById('cronList').innerHTML =
                cronJobs.map(c => `
                    <div class="cron-item">
                        <span class="cron-icon">${c.icon}</span>
                        <div class="cron-info">
                            <div class="cron-name">${c.name}</div>
                            <div class="cron-schedule">${c.schedule}</div>
                        </div>
                        <span class="cron-status ${c.status}">${c.status}</span>
                    </div>
                `).join('');

            document.getElementById('timeline').innerHTML =
                '<div class="empty-state"><div class="icon">üìã</div>Activity will appear here</div>';

            document.getElementById('alertsList').innerHTML =
                '<div class="empty-state"><div class="icon">‚úÖ</div>No alerts</div>';

            document.getElementById('hourlyChart').innerHTML =
                '<div class="empty-state">No activity data yet</div>';

            document.getElementById('uptime').textContent = 'Uptime: Calculating...';
            calculateUptime();
        }

        function renderDashboard(data) {
            const requests = data.requests || [];

            // System Status
            document.getElementById('systemStatusList').innerHTML =
                systemStatus.map(s => `
                    <div class="status-row">
                        <span class="status-label">${s.name}</span>
                        <span class="status-value ${s.class}">${s.value}</span>
                    </div>
                `).join('');

            // Stats
            const total = requests.length;
            const oneWeekAgo = (Date.now() / 1000) - (7 * 24 * 60 * 60);
            const weekCount = requests.filter(r => r.timestamp >= oneWeekAgo).length;
            const completed = requests.filter(r => r.status === 'completed').length;

            document.getElementById('quickStats').innerHTML = `
                <div class="metric-card success">
                    <div class="metric-label">Total Requests</div>
                    <div class="metric-value">${total}</div>
                    <div class="metric-sub">${weekCount} this week</div>
                </div>
                <div class="metric-card ${completed === total ? 'success' : 'warning'}">
                    <div class="metric-label">Completion</div>
                    <div class="metric-value">${total > 0 ? Math.round((completed / total) * 100) : 0}%</div>
                    <div class="metric-sub">${completed}/${total} done</div>
                </div>
            `;
            document.getElementById('statCount').textContent = `${total} requests`;

            // Categories
            const categoryCounts = {};
            requests.forEach(r => {
                categoryCounts[r.category] = (categoryCounts[r.category] || 0) + 1;
            });

            const sortedCategories = Object.entries(categoryCounts).sort((a, b) => b[1] - a[1]);
            const topCat = sortedCategories[0];

            document.getElementById('categoryList').innerHTML = sortedCategories.length === 0
                ? '<div class="empty-state"><div class="icon">üì≠</div>No data yet</div>'
                : sortedCategories.map(([cat, count]) => {
                    const pct = total > 0 ? Math.round((count / total) * 100) : 0;
                    const catClass = cat.split(' ')[1]?.toLowerCase() || 'conversation';
                    return `
                        <div style="padding: 0.5rem 0; border-bottom: 1px solid #1f2937;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                <span class="category-pill ${catClass}">${cat}</span>
                                <span style="font-size: 0.8rem; color: #94a3b8;">${count} (${pct}%)</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${pct}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');

            if (topCat) {
                document.getElementById('topCategoryBadge').textContent =
                    topCat[0].split(' ')[1] || topCat[0];
            }

            // Cron Jobs
            document.getElementById('cronList').innerHTML =
                cronJobs.map(c => `
                    <div class="cron-item">
                        <span class="cron-icon">${c.icon}</span>
                        <div class="cron-info">
                            <div class="cron-name">${c.name}</div>
                            <div class="cron-schedule">${c.schedule}</div>
                        </div>
                        <span class="cron-status ${c.status}">${c.status}</span>
                    </div>
                `).join('');

            // Timeline
            const recent = requests.slice(-15).reverse();
            document.getElementById('timeline').innerHTML = recent.length === 0
                ? '<div class="empty-state"><div class="icon">üìã</div>Activity will appear here</div>'
                : recent.map(r => {
                    const pstDate = new Date((r.timestamp - 8 * 3600) * 1000);
                    const statusClass = r.status === 'completed' ? 'completed' : r.status === 'pending' ? 'pending' : 'error';
                    return `
                        <div class="timeline-item ${statusClass}">
                            <div class="timeline-time">${pstDate.toLocaleTimeString('en-US', {
                                hour: 'numeric',
                                minute: '2-digit'
                            })}</div>
                            <div class="timeline-content">
                                <div class="timeline-text">${r.text.substring(0, 60)}${r.text.length > 60 ? '...' : ''}</div>
                                <div class="timeline-meta">${r.category} ‚Ä¢ ${r.status}</div>
                            </div>
                        </div>
                    `;
                }).join('');

            // Alerts
            const alerts = generateAlerts(requests);
            document.getElementById('alertsList').innerHTML = alerts.length === 0
                ? '<div class="empty-state"><div class="icon">‚úÖ</div>No alerts</div>'
                : alerts.map(a => `
                    <div class="alert-item ${a.level}">
                        <span class="alert-icon">${a.icon}</span>
                        <div>
                            <div class="alert-text">${a.text}</div>
                            <div class="alert-time">${a.time}</div>
                        </div>
                    </div>
                `).join('');
            document.getElementById('alertCount').textContent = alerts.length;

            // Hourly Chart
            renderHourlyChart(requests);

            // Streak
            const streak = calculateStreak(requests);
            document.getElementById('streak').textContent = `${streak} days`;

            // Uptime
            calculateUptime();
        }

        function generateAlerts(requests) {
            const alerts = [];
            const pending = requests.filter(r => r.status === 'pending');
            if (pending.length > 0) {
                alerts.push({
                    level: 'warning',
                    icon: '‚è≥',
                    text: `${pending.length} pending requests`,
                    time: 'Action needed'
                });
            }
            const oneDayAgo = (Date.now() / 1000) - (24 * 60 * 60);
            const recentActivity = requests.filter(r => r.timestamp >= oneDayAgo);
            if (recentActivity.length === 0 && requests.length > 0) {
                alerts.push({
                    level: 'info',
                    icon: 'üì≠',
                    text: 'No activity in last 24 hours',
                    time: 'Check in'
                });
            }
            return alerts;
        }

        function renderHourlyChart(requests) {
            const timeCounts = Array(24).fill(0);
            requests.forEach(r => {
                const pstDate = new Date((r.timestamp - 8 * 3600) * 1000);
                const hour = pstDate.getHours();
                timeCounts[hour]++;
            });

            const maxCount = Math.max(...timeCounts, 1);
            const chart = document.getElementById('hourlyChart');
            chart.innerHTML = timeCounts.map((count, hour) => {
                const height = (count / maxCount) * 100;
                const isActive = hour >= 9 && hour <= 17;
                return `
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 2px;">
                        <div style="
                            width: 100%;
                            height: ${Math.max(height, 2)}%;
                            background: ${count > 0 ? (isActive ? '#3b82f6' : '#6366f1') : '#1f2937'};
                            border-radius: 2px;
                            min-height: 4px;
                        "></div>
                        <span style="font-size: 0.55rem; color: #64748b;">${hour % 12 || 12}</span>
                    </div>
                `;
            }).join('');
        }

        function calculateStreak(requests) {
            if (requests.length === 0) return 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            let streak = 0;
            let checkDate = new Date(today);

            while (true) {
                const dayStart = Math.floor(checkDate.getTime() / 1000);
                const dayEnd = dayStart + 24 * 60 * 60;
                const hasActivity = requests.some(r => r.timestamp >= dayStart && r.timestamp < dayEnd);

                if (hasActivity) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            return streak;
        }

        function calculateUptime() {
            // Mock uptime - in production, this would come from the system
            const uptimeHours = Math.floor(Math.random() * 30) + 1;
            const uptimeDays = Math.floor(uptimeHours / 24);
            const remainingHours = uptimeHours % 24;
            if (uptimeDays > 0) {
                document.getElementById('uptime').textContent = `Uptime: ${uptimeDays}d ${remainingHours}h`;
            } else {
                document.getElementById('uptime').textContent = `Uptime: ${uptimeHours}h`;
            }
        }

        function exportData() {
            fetch('request-log.json')
                .then(response => response.json())
                .then(data => {
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'jarvis-data-export.json';
                    a.click();
                    URL.revokeObjectURL(url);
                });
        }

        function clearAlerts() {
            document.getElementById('alertsList').innerHTML =
                '<div class="empty-state"><div class="icon">‚úÖ</div>Alerts cleared</div>';
            document.getElementById('alertCount').textContent = '0';
        }

        // Load data and refresh every 30 seconds
        loadData();
        setInterval(loadData, 30000);
    </script>
</body>
</html>
