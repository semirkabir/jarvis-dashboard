<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis Mission Control</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            background: #0a0e17;
            color: #e2e8f0;
            overflow: hidden;
            height: 100vh;
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Left Sidebar - Navigation */
        .left-sidebar {
            width: 60px;
            background: #111827;
            border-right: 1px solid #1f2937;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0;
            transition: width 0.3s ease;
            flex-shrink: 0;
            z-index: 100;
        }
        .left-sidebar.expanded {
            width: 220px;
        }
        .sidebar-toggle {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1f2937;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }
        .sidebar-toggle:hover { background: #374151; }
        .nav-item {
            width: 100%;
            display: flex;
            align-items: center;
            padding: 0.75rem;
            cursor: pointer;
            border-radius: 8px;
            margin: 0.25rem 0.5rem;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .nav-item:hover { background: #1f2937; }
        .nav-item.active { background: #3b82f6; color: white; }
        .nav-icon { font-size: 1.25rem; min-width: 30px; }
        .nav-label {
            font-size: 0.85rem;
            margin-left: 0.75rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .left-sidebar.expanded .nav-label { opacity: 1; }
        .nav-divider {
            height: 1px;
            background: #1f2937;
            width: 80%;
            margin: 0.5rem auto;
        }
        .sidebar-footer {
            margin-top: auto;
            padding: 0.5rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-bottom: 1px solid #334155;
            flex-shrink: 0;
        }
        .header-left { display: flex; align-items: center; gap: 1rem; }
        .status-dot {
            width: 10px; height: 10px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            50% { opacity: 0.7; box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
        }
        .header h1 {
            font-size: 1.1rem;
            color: #60a5fa;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .header-right { display: flex; align-items: center; gap: 1rem; }
        .page-title { font-size: 0.85rem; color: #94a3b8; }
        .chat-toggle {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.25rem;
        }
        .chat-toggle:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4); }

        /* Page Content */
        .page-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .page { display: none; }
        .page.active { display: block; }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .panel {
            background: #111827;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #1f2937;
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #1f2937;
        }
        .panel-title {
            font-size: 0.7rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .panel-badge {
            font-size: 0.6rem;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            background: #1f2937;
            color: #64748b;
        }
        .panel-badge.active { background: #22c55e; color: #064e3b; }
        .panel-badge.warning { background: #f59e0b; color: #78350f; }
        .panel-badge.error { background: #ef4444; color: #7f1d1d; }

        /* Task Board Styles */
        .board-container {
            display: flex;
            gap: 1rem;
            height: calc(100vh - 140px);
            overflow-x: auto;
        }
        .board-column {
            flex: 1;
            min-width: 300px;
            background: #111827;
            border-radius: 8px;
            border: 1px solid #1f2937;
            display: flex;
            flex-direction: column;
        }
        .board-header {
            padding: 1rem;
            border-bottom: 1px solid #1f2937;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .board-title {
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .board-count {
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            background: #1f2937;
            color: #64748b;
        }
        .board-tasks {
            flex: 1;
            overflow-y: auto;
            padding: 0.75rem;
        }
        .task-card {
            background: #1e293b;
            padding: 0.75rem;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
            margin-bottom: 0.75rem;
            cursor: grab;
        }
        .task-card.scheduled { border-left-color: #f59e0b; }
        .task-card.completed { border-left-color: #22c55e; opacity: 0.7; }
        .task-card:hover { transform: translateX(4px); }
        .task-title { font-size: 0.85rem; margin-bottom: 0.5rem; }
        .task-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #64748b;
        }
        .task-category { padding: 0.1rem 0.4rem; border-radius: 3px; background: #1f2937; }

        /* System Status Page */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        .status-card {
            background: #111827;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #1f2937;
        }
        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #1f2937;
        }
        .status-row:last-child { border-bottom: none; }
        .status-label { font-size: 0.85rem; color: #e2e8f0; }
        .status-value { font-size: 0.85rem; font-weight: 600; }
        .status-value.online { color: #22c55e; }
        .status-value.offline { color: #ef4444; }
        .status-value.pending { color: #f59e0b; }

        /* Right Sidebar - Chat */
        .right-sidebar {
            width: 0;
            background: #111827;
            border-left: 1px solid #1f2937;
            transition: width 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex-shrink: 0;
        }
        .right-sidebar.expanded {
            width: 380px;
        }
        .chat-header {
            padding: 1rem;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .chat-avatar {
            width: 36px;
            height: 36px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        .chat-info h3 { font-size: 0.9rem; color: white; }
        .chat-info span { font-size: 0.7rem; color: rgba(255,255,255,0.7); }
        .chat-close {
            margin-left: auto;
            cursor: pointer;
            font-size: 1.25rem;
            opacity: 0.7;
        }
        .chat-close:hover { opacity: 1; }
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        .message.user { flex-direction: row-reverse; }
        .message-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            flex-shrink: 0;
        }
        .message.jarvis .message-avatar { background: #6366f1; }
        .message.user .message-avatar { background: #3b82f6; }
        .message-content {
            max-width: 80%;
            padding: 0.6rem 0.85rem;
            border-radius: 12px;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        .message.jarvis .message-content {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 12px 12px 12px 4px;
        }
        .message.user .message-content {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border-radius: 12px 12px 4px 12px;
        }
        .message-time {
            font-size: 0.65rem;
            color: #64748b;
            margin-top: 0.25rem;
        }
        .message.user .message-time { text-align: right; }
        .chat-input {
            padding: 1rem;
            border-top: 1px solid #1f2937;
        }
        .chat-input-wrapper {
            display: flex;
            gap: 0.5rem;
        }
        .chat-input-wrapper input {
            flex: 1;
            background: #1e293b;
            border: 1px solid #1f2937;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            color: #e2e8f0;
            font-family: inherit;
            font-size: 0.85rem;
        }
        .chat-input-wrapper input:focus {
            outline: none;
            border-color: #6366f1;
        }
        .chat-send {
            width: 36px;
            height: 36px;
            background: #6366f1;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .chat-send:hover { background: #8b5cf6; }

        /* Metric Cards */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        .metric-card {
            background: #1e293b;
            padding: 0.75rem;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
        }
        .metric-card.success { border-left-color: #22c55e; }
        .metric-card.warning { border-left-color: #f59e0b; }
        .metric-card.danger { border-left-color: #ef4444; }
        .metric-label { font-size: 0.65rem; color: #64748b; text-transform: uppercase; }
        .metric-value { font-size: 1.1rem; font-weight: 700; color: #e2e8f0; }
        .metric-sub { font-size: 0.65rem; color: #64748b; margin-top: 0.25rem; }

        /* Timeline */
        .timeline { max-height: 250px; overflow-y: auto; }
        .timeline-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.5rem 0;
            border-left: 2px solid #1f2937;
            padding-left: 1rem;
            margin-left: 0.5rem;
            position: relative;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 0.6rem;
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
        }
        .timeline-time { font-size: 0.7rem; color: #64748b; min-width: 60px; }
        .timeline-text { font-size: 0.8rem; color: #e2e8f0; }

        /* Alerts */
        .alert-item {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #1e293b;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            border-left: 3px solid;
        }
        .alert-item.critical { border-left-color: #ef4444; background: #1f1d1d; }
        .alert-item.warning { border-left-color: #f59e0b; }
        .alert-item.info { border-left-color: #3b82f6; }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #475569;
        }
        .empty-state .icon { font-size: 2rem; margin-bottom: 0.5rem; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Progress Bar */
        .progress-bar {
            height: 3px;
            background: #1f2937;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.25rem;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 2px;
        }
        .category-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            font-size: 0.65rem;
            background: #1e293b;
            color: #e2e8f0;
        }
        .category-pill::before {
            content: '';
            width: 6px; height: 6px;
            border-radius: 50%;
        }
        .category-pill.analysis::before { background: #10b981; }
        .category-pill.writing::before { background: #3b82f6; }
        .category-pill.technical::before { background: #8b5cf6; }
        .category-pill.markets::before { background: #14b8a6; }

        /* Cron Items */
        .cron-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem;
            background: #1e293b;
            border-radius: 4px;
            margin-bottom: 0.4rem;
        }
        .cron-icon { font-size: 0.9rem; }
        .cron-info { flex: 1; }
        .cron-name { font-size: 0.75rem; color: #e2e8f0; font-weight: 600; }
        .cron-schedule { font-size: 0.65rem; color: #64748b; }
        .cron-status {
            font-size: 0.6rem;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            background: #22c55e;
            color: #064e3b;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Left Sidebar -->
        <div class="left-sidebar" id="leftSidebar">
            <div class="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</div>

            <div class="nav-item active" data-page="dashboard" onclick="showPage('dashboard')">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Dashboard</span>
            </div>

            <div class="nav-item" data-page="tasks" onclick="showPage('tasks')">
                <span class="nav-icon">üìã</span>
                <span class="nav-label">Tasks</span>
            </div>

            <div class="nav-item" data-page="status" onclick="showPage('status')">
                <span class="nav-icon">‚ö°</span>
                <span class="nav-label">System Status</span>
            </div>

            <div class="nav-item" data-page="missions" onclick="showPage('missions')">
                <span class="nav-icon">üéØ</span>
                <span class="nav-label">Missions</span>
            </div>

            <div class="nav-item" data-page="alerts" onclick="showPage('alerts')">
                <span class="nav-icon">üö®</span>
                <span class="nav-label">Alerts</span>
            </div>

            <div class="nav-divider"></div>

            <div class="nav-item" data-page="pricing" onclick="showPage('pricing')">
                <span class="nav-icon">üí∞</span>
                <span class="nav-label">Price & Usage</span>
            </div>

            <div class="sidebar-footer">
                <div class="nav-item" onclick="location.reload()">
                    <span class="nav-icon">üîÑ</span>
                    <span class="nav-label">Refresh</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <div class="status-dot"></div>
                    <h1 id="pageTitle">ü§ñ Jarvis Mission Control</h1>
                </div>
                <div class="header-right">
                    <span class="page-title" id="currentDate"></span>
                    <div class="chat-toggle" onclick="toggleChat()">üí¨</div>
                </div>
            </div>

            <!-- Page Container -->
            <div class="page-container">
                <!-- Dashboard Page -->
                <div class="page active" id="page-dashboard">
                    <div class="dashboard-grid">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">‚ö° Quick Stats</div>
                                <span class="panel-badge" id="statCount">0</span>
                            </div>
                            <div class="metric-grid" id="quickStats"></div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üìà Categories</div>
                            </div>
                            <div id="categoryList" style="padding: 0.5rem 0;"></div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">‚è∞ Active Crons</div>
                            </div>
                            <div id="cronList"></div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üìä Streak</div>
                            </div>
                            <div style="text-align: center; padding: 1rem;">
                                <div style="font-size: 0.65rem; color: #64748b;">DAILY ACTIVITY</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: #22c55e;" id="streak">0 days</div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üìã Activity Timeline</div>
                            </div>
                            <div class="timeline" id="timeline"></div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üö® Alerts</div>
                            </div>
                            <div id="alertsList"></div>
                        </div>
                    </div>

                    <div class="panel" style="margin-top: 1rem;">
                        <div class="panel-header">
                            <div class="panel-title">üìä Activity by Hour (PST)</div>
                        </div>
                        <div id="hourlyChart" style="display: flex; align-items: flex-end; gap: 3px; height: 80px; padding: 0.5rem 0;"></div>
                    </div>
                </div>

                <!-- Tasks Page -->
                <div class="page" id="page-tasks">
                    <div class="board-container">
                        <div class="board-column">
                            <div class="board-header">
                                <div class="board-title">
                                    üìÖ Scheduled
                                    <span class="board-count" id="scheduledCount">0</span>
                                </div>
                            </div>
                            <div class="board-tasks" id="scheduledTasks"></div>
                        </div>

                        <div class="board-column">
                            <div class="board-header">
                                <div class="board-title">
                                    üìù To Do
                                    <span class="board-count" id="todoCount">0</span>
                                </div>
                            </div>
                            <div class="board-tasks" id="todoTasks"></div>
                        </div>

                        <div class="board-column">
                            <div class="board-header">
                                <div class="board-title">
                                    ‚úÖ Completed
                                    <span class="board-count" id="completedCount">0</span>
                                </div>
                            </div>
                            <div class="board-tasks" id="completedTasks"></div>
                        </div>
                    </div>
                </div>

                <!-- System Status Page -->
                <div class="page" id="page-status">
                    <div class="status-grid">
                        <div class="status-card">
                            <div class="panel-header">
                                <div class="panel-title">‚ö° System Status</div>
                            </div>
                            <div id="systemStatusList"></div>
                        </div>

                        <div class="status-card">
                            <div class="panel-header">
                                <div class="panel-title">üì° Services</div>
                            </div>
                            <div id="servicesList"></div>
                        </div>
                    </div>

                    <div class="panel" style="margin-top: 1rem;">
                        <div class="panel-header">
                            <div class="panel-title">‚è∞ Cron Jobs Status</div>
                        </div>
                        <div id="cronStatusList"></div>
                    </div>
                </div>

                <!-- Missions Page -->
                <div class="page" id="page-missions">
                    <div class="panel" style="margin-bottom: 1rem;">
                        <div class="panel-header">
                            <div class="panel-title">üéØ Active Missions</div>
                        </div>
                        <div class="empty-state">
                            <div class="icon">üéØ</div>
                            <p>No active missions</p>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">üìú Mission History</div>
                        </div>
                        <div class="empty-state">
                            <div class="icon">üìú</div>
                            <p>No mission history yet</p>
                        </div>
                    </div>
                </div>

                <!-- Alerts Page -->
                <div class="page" id="page-alerts">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">üö® All Alerts</div>
                        </div>
                        <div id="allAlertsList"></div>
                    </div>
                </div>

                <!-- Pricing & Usage Page -->
                <div class="page" id="page-pricing">
                    <div class="dashboard-grid">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üí∞ Token Usage</div>
                            </div>
                            <div style="text-align: center; padding: 1rem;">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #e2e8f0;" id="totalTokens">0</div>
                                <div style="font-size: 0.7rem; color: #64748b;">Total tokens (session)</div>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üí∏ Estimated Cost</div>
                            </div>
                            <div style="text-align: center; padding: 1rem;">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #22c55e;" id="estimatedCost">$0.00</div>
                                <div style="font-size: 0.7rem; color: #64748b;">Based on current model pricing</div>
                            </div>
                        </div>
                    </div>

                    <div class="panel" style="margin-top: 1rem;">
                        <div class="panel-header">
                            <div class="panel-title">üìä Usage by Category</div>
                        </div>
                        <div id="usageByCategory"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar - Chat -->
        <div class="right-sidebar" id="rightSidebar">
            <div class="chat-header">
                <div class="chat-avatar">ü§ñ</div>
                <div class="chat-info">
                    <h3>Jarvis</h3>
                    <span>AI Assistant</span>
                </div>
                <div class="chat-close" onclick="toggleChat()">‚úï</div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message jarvis">
                    <div class="message-avatar">ü§ñ</div>
                    <div class="message-content">
                        Hey Mir! I'm ready to help. What do you need?
                        <div class="message-time">Just now</div>
                    </div>
                </div>
            </div>

            <div class="chat-input">
                <div class="chat-input-wrapper">
                    <input type="text" id="chatInput" placeholder="Type a message..." onkeypress="handleChatKeypress(event)">
                    <button class="chat-send" onclick="sendMessage()">‚û§</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentPage = 'dashboard';
        let chatOpen = false;
        let sidebarOpen = false;

        // Navigation
        function toggleSidebar() {
            sidebarOpen = !sidebarOpen;
            document.getElementById('leftSidebar').classList.toggle('expanded', sidebarOpen);
        }

        function showPage(page) {
            currentPage = page;
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.page === page);
            });
            document.querySelectorAll('.page').forEach(p => {
                p.classList.toggle('active', p.id === 'page-' + page);
            });

            const titles = {
                dashboard: 'ü§ñ Jarvis Mission Control',
                tasks: 'üìã Task Board',
                status: '‚ö° System Status',
                missions: 'üéØ Missions',
                alerts: 'üö® Alerts',
                pricing: 'üí∞ Price & Usage'
            };
            document.getElementById('pageTitle').textContent = titles[page] || 'Jarvis';
        }

        function toggleChat() {
            chatOpen = !chatOpen;
            document.getElementById('rightSidebar').classList.toggle('expanded', chatOpen);
            if (chatOpen) {
                document.getElementById('chatInput').focus();
            }
        }

        // Chat
        function handleChatKeypress(e) {
            if (e.key === 'Enter') sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;

            // Add user message
            addMessage('user', text);
            input.value = '';

            // Simulate Jarvis response
            setTimeout(() => {
                const responses = [
                    "Got it! Working on that now.",
                    "On it! üëç",
                    "I'll handle that for you.",
                    "Understood. Processing...",
                    "Sure thing! Give me a moment.",
                    "Let me take care of that."
                ];
                addMessage('jarvis', responses[Math.floor(Math.random() * responses.length)]);
            }, 1000);
        }

        function addMessage(type, text) {
            const container = document.getElementById('chatMessages');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.innerHTML = `
                <div class="message-avatar">${type === 'jarvis' ? 'ü§ñ' : 'üë§'}</div>
                <div class="message-content">
                    ${text}
                    <div class="message-time">${new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit'})}</div>
                </div>
            `;
            container.appendChild(message);
            container.scrollTop = container.scrollHeight;
        }

        // Data loading
        function loadData() {
            fetch('request-log.json?t=' + Date.now())
                .then(response => response.json())
                .then(data => {
                    renderAll(data);
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                });
        }

        function renderAll(data) {
            const requests = data.requests || [];

            // Dashboard
            renderDashboard(requests);

            // Tasks
            renderTasks(requests);

            // System Status
            renderSystemStatus();

            // Pricing
            renderPricing(requests);
        }

        function renderDashboard(requests) {
            const total = requests.length;
            const completed = requests.filter(r => r.status === 'completed').length;

            // Quick Stats
            document.getElementById('quickStats').innerHTML = `
                <div class="metric-card success">
                    <div class="metric-label">Total</div>
                    <div class="metric-value">${total}</div>
                </div>
                <div class="metric-card ${completed === total ? 'success' : 'warning'}">
                    <div class="metric-label">Done</div>
                    <div class="metric-value">${completed}</div>
                    <div class="metric-sub">${total > 0 ? Math.round((completed / total) * 100) : 0}%</div>
                </div>
            `;
            document.getElementById('statCount').textContent = total + ' requests';

            // Categories
            const categoryCounts = {};
            requests.forEach(r => {
                categoryCounts[r.category] = (categoryCounts[r.category] || 0) + 1;
            });

            const sortedCategories = Object.entries(categoryCounts).sort((a, b) => b[1] - a[1]);
            document.getElementById('categoryList').innerHTML = sortedCategories.length === 0
                ? '<div class="empty-state"><div class="icon">üì≠</div></div>'
                : sortedCategories.slice(0, 5).map(([cat, count]) => {
                    const pct = total > 0 ? Math.round((count / total) * 100) : 0;
                    const catClass = cat.split(' ')[1]?.toLowerCase() || 'conversation';
                    return `
                        <div style="padding: 0.3rem 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.15rem;">
                                <span class="category-pill ${catClass}" style="font-size: 0.65rem;">${cat}</span>
                                <span style="font-size: 0.7rem; color: #94a3b8;">${count}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${pct}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');

            // Crons
            const cronJobs = [
                { name: 'Nightly Build', icon: 'üèóÔ∏è', schedule: 'Daily 3 AM PST', status: 'active' },
                { name: 'Market Report', icon: 'üìä', schedule: 'Daily 9 AM PST', status: 'active' },
                { name: 'Auto-Update', icon: 'üîÑ', schedule: 'Daily 11 PM PST', status: 'active' },
                { name: 'Heartbeat', icon: 'üíì', schedule: 'Every 4h', status: 'active' }
            ];
            document.getElementById('cronList').innerHTML = cronJobs.map(c => `
                <div class="cron-item">
                    <span class="cron-icon">${c.icon}</span>
                    <div class="cron-info">
                        <div class="cron-name">${c.name}</div>
                        <div class="cron-schedule">${c.schedule}</div>
                    </div>
                    <span class="cron-status">${c.status}</span>
                </div>
            `).join('');

            // Streak
            const streak = calculateStreak(requests);
            document.getElementById('streak').textContent = streak + ' days';

            // Timeline
            const recent = requests.slice(-10).reverse();
            document.getElementById('timeline').innerHTML = recent.length === 0
                ? '<div class="empty-state"><div class="icon">üìã</div></div>'
                : recent.map(r => {
                    const time = new Date((r.timestamp - 8 * 3600) * 1000).toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit'});
                    return `
                        <div class="timeline-item">
                            <span class="timeline-time">${time}</span>
                            <span class="timeline-text">${r.text.substring(0, 40)}...</span>
                        </div>
                    `;
                }).join('');

            // Alerts
            const alerts = generateAlerts(requests);
            document.getElementById('alertsList').innerHTML = alerts.length === 0
                ? '<div class="empty-state"><div class="icon">‚úÖ</div></div>'
                : alerts.map(a => `
                    <div class="alert-item ${a.level}">
                        <span>${a.icon}</span>
                        <span style="font-size: 0.75rem; color: #e2e8f0;">${a.text}</span>
                    </div>
                `).join('');

            // Hourly Chart
            renderHourlyChart(requests);
        }

        function renderTasks(requests) {
            const scheduled = requests.filter(r => r.category?.includes('Reminders') || r.status === 'pending');
            const todo = requests.filter(r => r.status === 'pending' && !r.category?.includes('Reminders'));
            const completed = requests.filter(r => r.status === 'completed');

            document.getElementById('scheduledCount').textContent = scheduled.length;
            document.getElementById('todoCount').textContent = todo.length;
            document.getElementById('completedCount').textContent = completed.length;

            const renderTaskList = (tasks, containerId) => {
                const container = document.getElementById(containerId);
                container.innerHTML = tasks.length === 0
                    ? '<div class="empty-state"><div class="icon">üì≠</div></div>'
                    : tasks.map(r => `
                        <div class="task-card ${r.status === 'completed' ? 'completed' : r.category?.includes('Reminders') ? 'scheduled' : ''}">
                            <div class="task-title">${r.text.substring(0, 50)}${r.text.length > 50 ? '...' : ''}</div>
                            <div class="task-meta">
                                <span class="task-category">${r.category?.split(' ')[1] || 'Task'}</span>
                                <span>${new Date((r.timestamp - 8 * 3600) * 1000).toLocaleDateString()}</span>
                            </div>
                        </div>
                    `).join('');
            };

            renderTaskList(scheduled.slice(0, 10), 'scheduledTasks');
            renderTaskList(todo.slice(0, 10), 'todoTasks');
            renderTaskList(completed.slice(-10).reverse(), 'completedTasks');
        }

        function renderSystemStatus() {
            const systemStatus = [
                { name: 'Gateway', value: 'Online', class: 'online' },
                { name: 'Moltbook API', value: 'Connected', class: 'online' },
                { name: 'Telegram Bot', value: 'Active', class: 'online' },
                { name: 'Database', value: 'Synced', class: 'online' }
            ];

            document.getElementById('systemStatusList').innerHTML = systemStatus.map(s => `
                <div class="status-row">
                    <span class="status-label">${s.name}</span>
                    <span class="status-value ${s.class}">${s.value}</span>
                </div>
            `).join('');

            document.getElementById('servicesList').innerHTML = systemStatus.map(s => `
                <div class="status-row">
                    <span class="status-label">${s.name}</span>
                    <span class="status-value ${s.class}">${s.value}</span>
                </div>
            `).join('');

            const cronStatus = [
                { name: 'Nightly Build', status: '‚úÖ Running', last: 'Today 3 AM' },
                { name: 'Market Report', status: '‚úÖ Running', last: 'Today 9 AM' },
                { name: 'Auto-Update', status: '‚úÖ Running', last: 'Yesterday 11 PM' },
                { name: 'Heartbeat', status: '‚úÖ Running', last: '1 hour ago' }
            ];

            document.getElementById('cronStatusList').innerHTML = cronStatus.map(c => `
                <div class="cron-item">
                    <div class="cron-info">
                        <div class="cron-name">${c.name}</div>
                        <div class="cron-schedule">${c.last}</div>
                    </div>
                    <span style="font-size: 0.7rem; color: #22c55e;">${c.status}</span>
                </div>
            `).join('');
        }

        function renderPricing(requests) {
            // Mock token usage calculation
            const totalTokens = requests.length * 1500; // Estimate ~1500 tokens per request
            const costPerToken = 0.000002; // Example pricing
            const estimatedCost = totalTokens * costPerToken;

            document.getElementById('totalTokens').textContent = totalTokens.toLocaleString();
            document.getElementById('estimatedCost').textContent = '$' + estimatedCost.toFixed(2);

            // Usage by category
            const categoryUsage = {};
            requests.forEach(r => {
                categoryUsage[r.category] = (categoryUsage[r.category] || 0) + 1500;
            });

            const maxUsage = Math.max(...Object.values(categoryUsage), 1);
            document.getElementById('usageByCategory').innerHTML = Object.entries(categoryUsage).map(([cat, tokens]) => {
                const pct = (tokens / maxUsage) * 100;
                return `
                    <div style="padding: 0.5rem 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span style="font-size: 0.8rem;">${cat}</span>
                            <span style="font-size: 0.75rem; color: #94a3b8;">${tokens.toLocaleString()} tokens</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${pct}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderHourlyChart(requests) {
            const timeCounts = Array(24).fill(0);
            requests.forEach(r => {
                const pstDate = new Date((r.timestamp - 8 * 3600) * 1000);
                const hour = pstDate.getHours();
                timeCounts[hour]++;
            });

            const maxCount = Math.max(...timeCounts, 1);
            document.getElementById('hourlyChart').innerHTML = timeCounts.map((count, hour) => {
                const height = (count / maxCount) * 100;
                const isActive = hour >= 9 && hour <= 17;
                return `
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 2px;">
                        <div style="
                            width: 100%;
                            height: ${Math.max(height, 2)}%;
                            background: ${count > 0 ? (isActive ? '#3b82f6' : '#6366f1') : '#1f2937'};
                            border-radius: 2px;
                            min-height: 4px;
                        "></div>
                        <span style="font-size: 0.5rem; color: #64748b;">${hour % 12 || 12}</span>
                    </div>
                `;
            }).join('');
        }

        function generateAlerts(requests) {
            const alerts = [];
            const pending = requests.filter(r => r.status === 'pending');
            if (pending.length > 0) {
                alerts.push({ level: 'warning', icon: '‚è≥', text: `${pending.length} pending requests` });
            }
            return alerts;
        }

        function calculateStreak(requests) {
            if (requests.length === 0) return 0;
            let streak = 0;
            let checkDate = new Date();
            checkDate.setHours(0, 0, 0, 0);

            while (true) {
                const dayStart = Math.floor(checkDate.getTime() / 1000);
                const dayEnd = dayStart + 24 * 60 * 60;
                const hasActivity = requests.some(r => r.timestamp >= dayStart && r.timestamp < dayEnd);

                if (hasActivity) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            return streak;
        }

        // Init
        function init() {
            document.getElementById('currentDate').textContent =
                new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
            loadData();
            setInterval(loadData, 30000);
        }

        init();
    </script>
</body>
</html>
