<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis Mission Control</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            background: #0a0e17;
            color: #e2e8f0;
            overflow: hidden;
            height: 100vh;
        }

        /* Layout */
        .app-container { display: flex; height: 100vh; }

        /* Left Sidebar */
        .left-sidebar {
            width: 60px;
            background: #111827;
            border-right: 1px solid #1f2937;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0;
            transition: width 0.3s ease;
            flex-shrink: 0;
            z-index: 100;
        }
        .left-sidebar.expanded { width: 220px; }
        .sidebar-toggle {
            width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            background: #1f2937; border-radius: 8px; cursor: pointer;
            margin-bottom: 1rem; transition: all 0.2s;
        }
        .sidebar-toggle:hover { background: #374151; }
        .nav-item {
            width: 100%;
            display: flex; align-items: center;
            padding: 0.75rem;
            cursor: pointer;
            border-radius: 8px;
            margin: 0.25rem 0.5rem;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .nav-item:hover { background: #1f2937; }
        .nav-item.active { background: #3b82f6; color: white; }
        .nav-icon { font-size: 1.25rem; min-width: 30px; }
        .nav-label {
            font-size: 0.85rem;
            margin-left: 0.75rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .left-sidebar.expanded .nav-label { opacity: 1; }
        .nav-divider { height: 1px; background: #1f2937; width: 80%; margin: 0.5rem auto; }
        .sidebar-footer { margin-top: auto; padding: 0.5rem; }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-bottom: 1px solid #334155;
            flex-shrink: 0;
        }
        .header-left { display: flex; align-items: center; gap: 1rem; }
        .status-dot {
            width: 10px; height: 10px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            50% { opacity: 0.7; box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
        }
        .header h1 {
            font-size: 1.1rem;
            color: #60a5fa;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .header-right { display: flex; align-items: center; gap: 1rem; }
        .page-title { font-size: 0.85rem; color: #94a3b8; }
        .chat-toggle {
            width: 44px; height: 44px;
            display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.25rem;
        }
        .chat-toggle:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4); }

        /* Page Content */
        .page-container { flex: 1; overflow-y: auto; padding: 1rem; }
        .page { display: none; }
        .page.active { display: block; }

        /* Panels */
        .panel {
            background: #111827;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #1f2937;
            margin-bottom: 1rem;
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #1f2937;
        }
        .panel-title {
            font-size: 0.7rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .panel-badge {
            font-size: 0.6rem;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            background: #1f2937;
            color: #64748b;
            cursor: pointer;
        }
        .panel-badge:hover { background: #374151; }
        .panel-badge.active { background: #22c55e; color: #064e3b; }
        .panel-badge.warning { background: #f59e0b; color: #78350f; }
        .panel-badge.error { background: #ef4444; color: #7f1d1d; }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        @media (max-width: 1200px) { .dashboard-grid { grid-template-columns: repeat(2, 1fr); } }

        /* Metric Cards */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        .metric-card {
            background: #1e293b;
            padding: 0.75rem;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
        }
        .metric-card.success { border-left-color: #22c55e; }
        .metric-card.warning { border-left-color: #f59e0b; }
        .metric-card.danger { border-left-color: #ef4444; }
        .metric-label { font-size: 0.65rem; color: #64748b; text-transform: uppercase; }
        .metric-value { font-size: 1.1rem; font-weight: 700; color: #e2e8f0; }
        .metric-sub { font-size: 0.65rem; color: #64748b; margin-top: 0.25rem; }

        /* Task Board */
        .board-container {
            display: flex;
            gap: 1rem;
            height: calc(100vh - 140px);
            overflow-x: auto;
        }
        .board-column {
            flex: 1;
            min-width: 300px;
            background: #111827;
            border-radius: 8px;
            border: 1px solid #1f2937;
            display: flex;
            flex-direction: column;
        }
        .board-column.drag-over {
            border: 2px dashed #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        .board-header {
            padding: 1rem;
            border-bottom: 1px solid #1f2937;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .board-title {
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .board-count {
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            background: #1f2937;
            color: #64748b;
        }
        .board-tasks {
            flex: 1;
            overflow-y: auto;
            padding: 0.75rem;
        }
        .task-card {
            background: #1e293b;
            padding: 0.75rem;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
            margin-bottom: 0.75rem;
            cursor: grab;
            transition: all 0.2s;
        }
        .task-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .task-card.scheduled { border-left-color: #f59e0b; }
        .task-card.completed { border-left-color: #22c55e; opacity: 0.7; }
        .task-card:hover { transform: translateX(4px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .task-title { font-size: 0.85rem; margin-bottom: 0.5rem; }
        .task-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #64748b;
        }
        .task-category { padding: 0.1rem 0.4rem; border-radius: 3px; background: #1f2937; }
        .task-delete {
            font-size: 0.75rem;
            color: #ef4444;
            cursor: pointer;
            margin-left: 0.5rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .task-card:hover .task-delete { opacity: 1; }

        /* Add Task Button */
        .add-task-btn {
            width: 100%;
            padding: 0.5rem;
            background: #1f2937;
            border: 2px dashed #374151;
            border-radius: 6px;
            color: #64748b;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .add-task-btn:hover {
            border-color: #3b82f6;
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        /* Cron Items */
        .cron-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #1e293b;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cron-item:hover { background: #374151; transform: translateX(4px); }
        .cron-icon { font-size: 1rem; }
        .cron-info { flex: 1; }
        .cron-name { font-size: 0.8rem; color: #e2e8f0; font-weight: 600; }
        .cron-schedule { font-size: 0.65rem; color: #64748b; }
        .cron-status {
            font-size: 0.6rem;
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
            background: #22c55e;
            color: #064e3b;
        }
        .cron-status.inactive { background: #64748b; color: #f1f5f9; }

        /* Usage Detail Table */
        .usage-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
        }
        .usage-table th {
            text-align: left;
            padding: 0.5rem;
            color: #94a3b8;
            border-bottom: 1px solid #1f2937;
            font-size: 0.65rem;
            text-transform: uppercase;
        }
        .usage-table td {
            padding: 0.5rem;
            border-bottom: 1px solid #1f2937;
        }
        .usage-table tr:hover { background: #1e293b; }
        .usage-table tr:last-child td { border-bottom: none; }

        /* Alert Items */
        .alert-item {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 0.75rem;
            background: #1e293b;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border-left: 3px solid;
        }
        .alert-item.critical { border-left-color: #ef4444; background: #1f1d1d; }
        .alert-item.warning { border-left-color: #f59e0b; }
        .alert-item.info { border-left-color: #3b82f6; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: #111827;
            border-radius: 12px;
            border: 1px solid #1f2937;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            width: 90%;
        }
        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #1f2937;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title { font-size: 1rem; font-weight: 600; color: #e2e8f0; }
        .modal-close {
            font-size: 1.25rem;
            color: #64748b;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close:hover { color: #e2e8f0; }
        .modal-body { padding: 1.5rem; }
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #1f2937;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        /* Forms */
        .form-group { margin-bottom: 1rem; }
        .form-label {
            display: block;
            font-size: 0.75rem;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }
        .form-input, .form-textarea, .form-select {
            width: 100%;
            background: #1e293b;
            border: 1px solid #1f2937;
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            color: #e2e8f0;
            font-family: inherit;
            font-size: 0.85rem;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
        }
        .form-textarea { min-height: 80px; resize: vertical; }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        .btn-primary:hover { background: #2563eb; }
        .btn-secondary {
            background: #1f2937;
            color: #e2e8f0;
        }
        .btn-secondary:hover { background: #374151; }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn-danger:hover { background: #dc2626; }

        /* Timeline */
        .timeline { max-height: 200px; overflow-y: auto; }
        .timeline-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.5rem 0;
            border-left: 2px solid #1f2937;
            padding-left: 1rem;
            margin-left: 0.5rem;
            position: relative;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 0.6rem;
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
        }
        .timeline-time { font-size: 0.7rem; color: #64748b; min-width: 60px; }
        .timeline-text { font-size: 0.8rem; color: #e2e8f0; }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #475569;
        }
        .empty-state .icon { font-size: 2rem; margin-bottom: 0.5rem; }

        /* Charts */
        .chart-bar-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .chart-bar-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .chart-bar-label {
            min-width: 100px;
            font-size: 0.75rem;
            color: #94a3b8;
        }
        .chart-bar-track {
            flex: 1;
            height: 24px;
            background: #1f2937;
            border-radius: 4px;
            overflow: hidden;
        }
        .chart-bar-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            font-size: 0.7rem;
            font-weight: 600;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Category Pills */
        .category-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            font-size: 0.65rem;
            background: #1e293b;
            color: #e2e8f0;
        }
        .category-pill::before {
            content: '';
            width: 6px; height: 6px;
            border-radius: 50%;
        }
        .category-pill.analysis::before { background: #10b981; }
        .category-pill.writing::before { background: #3b82f6; }
        .category-pill.technical::before { background: #8b5cf6; }
        .category-pill.markets::before { background: #14b8a6; }
        .category-pill.heartbeat::before { background: #64748b; }
        .category-pill.conversation::before { background: #6366f1; }
        .category-pill.research::before { background: #ec4899; }
        .category-pill.reminders::before { background: #f59e0b; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Progress Bar */
        .progress-bar {
            height: 3px;
            background: #1f2937;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.25rem;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 2px;
        }

        /* Status Row */
        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #1f2937;
        }
        .status-row:last-child { border-bottom: none; }
        .status-label { font-size: 0.85rem; color: #e2e8f0; }
        .status-value { font-size: 0.85rem; font-weight: 600; }
        .status-value.online { color: #22c55e; }
        .status-value.offline { color: #ef4444; }

        /* Right Sidebar - Chat */
        .right-sidebar {
            width: 0;
            background: #111827;
            border-left: 1px solid #1f2937;
            transition: width 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex-shrink: 0;
        }
        .right-sidebar.expanded { width: 380px; }
        .chat-header {
            padding: 1rem;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .chat-avatar {
            width: 36px; height: 36px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        .chat-info h3 { font-size: 0.9rem; color: white; }
        .chat-info span { font-size: 0.7rem; color: rgba(255,255,255,0.7); }
        .chat-close {
            margin-left: auto;
            cursor: pointer;
            font-size: 1.25rem;
            opacity: 0.7;
        }
        .chat-close:hover { opacity: 1; }
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        .message.user { flex-direction: row-reverse; }
        .message-avatar {
            width: 28px; height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            flex-shrink: 0;
        }
        .message.jarvis .message-avatar { background: #6366f1; }
        .message.user .message-avatar { background: #3b82f6; }
        .message-content {
            max-width: 80%;
            padding: 0.6rem 0.85rem;
            border-radius: 12px;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        .message.jarvis .message-content {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 12px 12px 12px 4px;
        }
        .message.user .message-content {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border-radius: 12px 12px 4px 12px;
        }
        .message-time {
            font-size: 0.65rem;
            color: #64748b;
            margin-top: 0.25rem;
        }
        .message.user .message-time { text-align: right; }
        .chat-input {
            padding: 1rem;
            border-top: 1px solid #1f2937;
        }
        .chat-input-wrapper {
            display: flex;
            gap: 0.5rem;
        }
        .chat-input-wrapper input {
            flex: 1;
            background: #1e293b;
            border: 1px solid #1f2937;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            color: #e2e8f0;
            font-family: inherit;
            font-size: 0.85rem;
        }
        .chat-input-wrapper input:focus {
            outline: none;
            border-color: #6366f1;
        }
        .chat-send {
            width: 36px; height: 36px;
            background: #6366f1;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .chat-send:hover { background: #8b5cf6; }

        /* Cron History */
        .cron-history-item {
            padding: 0.5rem;
            background: #1e293b;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
        }
        .cron-history-time {
            color: #94a3b8;
            font-size: 0.7rem;
            margin-bottom: 0.25rem;
        }
        .cron-history-status {
            display: inline-block;
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
            font-size: 0.65rem;
        }
        .cron-history-status.success { background: #22c55e; color: #064e3b; }
        .cron-history-status.error { background: #ef4444; color: #7f1d1d; }

        /* Time Distribution Chart */
        .time-dist-container {
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            gap: 2px;
            height: 120px;
        }
        .time-dist-bar {
            background: #1f2937;
            border-radius: 2px;
            position: relative;
            min-height: 4px;
        }
        .time-dist-bar:hover::after {
            content: attr(data-hour) ':00';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.6rem;
            color: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Left Sidebar -->
        <div class="left-sidebar" id="leftSidebar">
            <div class="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</div>

            <div class="nav-item active" data-page="dashboard" onclick="showPage('dashboard')">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Dashboard</span>
            </div>

            <div class="nav-item" data-page="tasks" onclick="showPage('tasks')">
                <span class="nav-icon">üìã</span>
                <span class="nav-label">Tasks</span>
            </div>

            <div class="nav-item" data-page="crons" onclick="showPage('crons')">
                <span class="nav-icon">‚è∞</span>
                <span class="nav-label">Cron Jobs</span>
            </div>

            <div class="nav-item" data-page="usage" onclick="showPage('usage')">
                <span class="nav-icon">üí∞</span>
                <span class="nav-label">Usage</span>
            </div>

            <div class="nav-item" data-page="alerts" onclick="showPage('alerts')">
                <span class="nav-icon">üö®</span>
                <span class="nav-label">Alerts</span>
            </div>

            <div class="nav-divider"></div>

            <div class="nav-item" data-page="categories" onclick="showPage('categories')">
                <span class="nav-icon">üìà</span>
                <span class="nav-label">Categories</span>
            </div>

            <div class="sidebar-footer">
                <div class="nav-item" onclick="location.reload()">
                    <span class="nav-icon">üîÑ</span>
                    <span class="nav-label">Refresh</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <div class="status-dot"></div>
                    <h1 id="pageTitle">ü§ñ Jarvis Mission Control</h1>
                </div>
                <div class="header-right">
                    <span class="page-title" id="currentDate"></span>
                    <div class="chat-toggle" onclick="toggleChat()">üí¨</div>
                </div>
            </div>

            <!-- Page Container -->
            <div class="page-container">
                <!-- Dashboard Page -->
                <div class="page active" id="page-dashboard">
                    <div class="dashboard-grid">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">‚ö° Quick Stats</div>
                                <span class="panel-badge" id="statCount">0</span>
                            </div>
                            <div class="metric-grid" id="quickStats"></div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üìà Top Categories</div>
                            </div>
                            <div id="topCategories" style="padding: 0.5rem 0;"></div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">‚è∞ Recent Activity</div>
                            </div>
                            <div class="timeline" id="timeline"></div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üìä Streak</div>
                            </div>
                            <div style="text-align: center; padding: 1rem;">
                                <div style="font-size: 0.65rem; color: #64748b;">DAILY ACTIVITY</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: #22c55e;" id="streak">0 days</div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">‚è∞ Time Distribution (PST)</div>
                            </div>
                            <div class="time-dist-container" id="timeDistChart"></div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üö® Recent Alerts</div>
                            </div>
                            <div id="recentAlerts"></div>
                        </div>
                    </div>
                </div>

                <!-- Tasks Page -->
                <div class="page" id="page-tasks">
                    <div class="board-container">
                        <div class="board-column" id="scheduled-column"
                             ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'scheduled')">
                            <div class="board-header">
                                <div class="board-title">
                                    üìÖ Scheduled
                                    <span class="board-count" id="scheduledCount">0</span>
                                </div>
                            </div>
                            <div class="board-tasks" id="scheduledTasks"></div>
                            <div style="padding: 0.75rem;">
                                <button class="add-task-btn" onclick="openTaskModal('scheduled')">+ Add Task</button>
                            </div>
                        </div>

                        <div class="board-column" id="todo-column"
                             ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'todo')">
                            <div class="board-header">
                                <div class="board-title">
                                    üìù To Do
                                    <span class="board-count" id="todoCount">0</span>
                                </div>
                            </div>
                            <div class="board-tasks" id="todoTasks"></div>
                            <div style="padding: 0.75rem;">
                                <button class="add-task-btn" onclick="openTaskModal('todo')">+ Add Task</button>
                            </div>
                        </div>

                        <div class="board-column" id="completed-column"
                             ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'completed')">
                            <div class="board-header">
                                <div class="board-title">
                                    ‚úÖ Completed
                                    <span class="board-count" id="completedCount">0</span>
                                </div>
                            </div>
                            <div class="board-tasks" id="completedTasks"></div>
                        </div>
                    </div>
                </div>

                <!-- Crons Page -->
                <div class="page" id="page-crons">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">‚è∞ Active Cron Jobs</div>
                            <span class="panel-badge active" id="cronBadge">4 Active</span>
                        </div>
                        <div id="cronList"></div>
                    </div>
                </div>

                <!-- Usage Page -->
                <div class="page" id="page-usage">
                    <div class="dashboard-grid">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üí∞ Total Usage</div>
                            </div>
                            <div style="text-align: center; padding: 1rem;">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #e2e8f0;" id="totalTokens">0</div>
                                <div style="font-size: 0.7rem; color: #64748b;">Total tokens (session)</div>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">üí∏ Estimated Cost</div>
                            </div>
                            <div style="text-align: center; padding: 1rem;">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #22c55e;" id="estimatedCost">$0.00</div>
                                <div style="font-size: 0.7rem; color: #64748b;">Current model pricing</div>
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">ü§ñ Model Usage Breakdown</div>
                        </div>
                        <table class="usage-table" id="modelUsageTable">
                            <thead>
                                <tr>
                                    <th>Model</th>
                                    <th>Tokens</th>
                                    <th>Requests</th>
                                    <th>%</th>
                                    <th>Avg/Req</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">‚è∞ Usage by Hour (PST)</div>
                        </div>
                        <div class="time-dist-container" id="usageByHour"></div>
                    </div>
                </div>

                <!-- Alerts Page -->
                <div class="page" id="page-alerts">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">üö® All Alerts</div>
                            <span class="panel-badge" id="alertCount">0</span>
                        </div>
                        <div id="allAlertsList"></div>
                    </div>
                </div>

                <!-- Categories Page -->
                <div class="page" id="page-categories">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">üìà Categories Breakdown</div>
                        </div>
                        <table class="usage-table" id="categoriesTable">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Count</th>
                                    <th>%</th>
                                    <th>Tokens</th>
                                    <th>Recent Activity</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">üìä Category Distribution Chart</div>
                        </div>
                        <div class="chart-bar-container" id="categoryChart"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar - Chat -->
        <div class="right-sidebar" id="rightSidebar">
            <div class="chat-header">
                <div class="chat-avatar">ü§ñ</div>
                <div class="chat-info">
                    <h3>Jarvis</h3>
                    <span>AI Assistant</span>
                </div>
                <div class="chat-close" onclick="toggleChat()">‚úï</div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message jarvis">
                    <div class="message-avatar">ü§ñ</div>
                    <div class="message-content">
                        Hey Mir! I'm ready to help. What do you need?
                        <div class="message-time">Just now</div>
                    </div>
                </div>
            </div>

            <div class="chat-input">
                <div class="chat-input-wrapper">
                    <input type="text" id="chatInput" placeholder="Type a message..." onkeypress="handleChatKeypress(event)">
                    <button class="chat-send" onclick="sendMessage()">‚û§</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal-overlay" id="taskModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="taskModalTitle">Add Task</div>
                <div class="modal-close" onclick="closeTaskModal()">‚úï</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Task Title</label>
                    <input type="text" class="form-input" id="taskTitle" placeholder="What needs to be done?">
                </div>
                <div class="form-group">
                    <label class="form-label">Description (optional)</label>
                    <textarea class="form-textarea" id="taskDescription" placeholder="Add more details..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-select" id="taskCategory">
                        <option value="üí¨ Conversation">üí¨ Conversation</option>
                        <option value="üîß Technical">üîß Technical</option>
                        <option value="üß† Research">üß† Research</option>
                        <option value="üìà Analysis">üìà Analysis</option>
                        <option value="üí∞ Markets">üí∞ Markets</option>
                        <option value="‚úçÔ∏è Writing">‚úçÔ∏è Writing</option>
                        <option value="üìÖ Reminders">üìÖ Reminders</option>
                    </select>
                </div>
                <div class="form-group" id="scheduleGroup" style="display: none;">
                    <label class="form-label">Schedule For</label>
                    <input type="datetime-local" class="form-input" id="taskSchedule">
                </div>
                <input type="hidden" id="taskColumn">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTaskModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveTask()">Save Task</button>
            </div>
        </div>
    </div>

    <!-- Cron Detail Modal -->
    <div class="modal-overlay" id="cronModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="cronModalTitle">Cron Details</div>
                <div class="modal-close" onclick="closeCronModal()">‚úï</div>
            </div>
            <div class="modal-body" id="cronModalBody"></div>
        </div>
    </div>

    <script>
        // State
        let currentPage = 'dashboard';
        let chatOpen = false;
        let sidebarOpen = false;
        let tasks = [];
        let draggedTask = null;

        // Mock cron data
        const cronJobs = [
            {
                id: 'nightly-build',
                name: 'Nightly Build',
                icon: 'üèóÔ∏è',
                schedule: 'Daily 3:00 AM PST',
                status: 'active',
                prompt: 'Read friction-log.md for targets. Pick ONE small, reversible improvement. Build during idle time. Commit with detailed message. Update NIGHTLY_BUILD.md.',
                history: [
                    { time: '2026-02-23 03:00 AM PST', status: 'success', duration: '1m 24s', result: 'API Health Monitor script created' },
                    { time: '2026-02-22 03:00 AM PST', status: 'success', duration: '58s', result: 'Skills registry created' },
                    { time: '2026-02-21 03:00 AM PST', status: 'success', duration: '1m 12s', result: 'Memory consolidation' },
                    { time: '2026-02-20 03:00 AM PST', status: 'error', duration: '2m 05s', result: 'Git conflict - resolved' }
                ]
            },
            {
                id: 'market-report',
                name: 'Daily Market Report',
                icon: 'üìä',
                schedule: 'Daily 9:00 AM PST',
                status: 'active',
                prompt: 'Generate daily market and geopolitical report. Fetch market futures, key geopolitical developments, economic indicators. Format for Telegram delivery.',
                history: [
                    { time: '2026-02-23 09:00 AM PST', status: 'success', duration: '10s', result: 'Report delivered' },
                    { time: '2026-02-22 09:00 AM PST', status: 'success', duration: '12s', result: 'Report delivered' },
                    { time: '2026-02-21 09:00 AM PST', status: 'success', duration: '11s', result: 'Report delivered' }
                ]
            },
            {
                id: 'auto-update',
                name: 'Daily Auto-Update',
                icon: 'üîÑ',
                schedule: 'Daily 11:00 PM PST',
                status: 'active',
                prompt: 'Check for Clawdbot and skill updates. Run npm install -g clawdbot@latest. Check for updates in hub-installed skills. Skip skills with local modifications. Restart gateway after updates.',
                history: [
                    { time: '2026-02-22 11:00 PM PST', status: 'success', duration: '4m 45s', result: 'Updated to v2026.1.24-3, gog skill updated' },
                    { time: '2026-02-21 11:00 PM PST', status: 'success', duration: '3m 30s', result: 'No updates available' },
                    { time: '2026-02-20 11:00 PM PST', status: 'success', duration: '5m 12s', result: '3 skills updated' }
                ]
            },
            {
                id: 'heartbeat',
                name: 'Heartbeat Check',
                icon: 'üíì',
                schedule: 'Every 4 hours',
                status: 'active',
                prompt: 'Read HEARTBEAT.md if it exists. Follow it strictly. Do not infer or repeat old tasks. Check Moltbook status (every 4+ hours). Review NIGHTLY_BUILD.md (every 3-4 days). Check friction-log.md for ongoing issues.',
                history: [
                    { time: '2026-02-23 16:00 PM PST', status: 'success', duration: '2s', result: 'HEARTBEAT_OK' },
                    { time: '2026-02-23 12:00 PM PST', status: 'success', duration: '3s', result: 'Moltbook checked' },
                    { time: '2026-02-23 08:00 AM PST', status: 'success', duration: '2s', result: 'HEARTBEAT_OK' }
                ]
            }
        ];

        // Mock model data
        const modelUsage = [
            { model: 'GLM-4.7', provider: 'Z-AI', tokens: 125000, requests: 85, cost: 0.0001 },
            { model: 'Claude 3.5 Haiku', provider: 'Anthropic', tokens: 45200, requests: 42, cost: 0.0008 },
            { model: 'GPT-4.1', provider: 'OpenAI', tokens: 28500, requests: 15, cost: 0.0025 },
            { model: 'Gemini 3 Pro', provider: 'Google', tokens: 18000, requests: 12, cost: 0.0015 }
        ];

        // Mock alerts
        const alerts = [
            { level: 'critical', icon: 'üî¥', title: 'Disk Space Warning', message: 'Drive at 95% capacity - cleanup needed', time: '2 hours ago' },
            { level: 'warning', icon: 'üü°', title: 'Pending Tasks', message: '8 tasks scheduled but not completed', time: '1 hour ago' },
            { level: 'info', icon: 'üîµ', title: 'Build Successful', message: 'Nightly build #9 completed successfully', time: '23 hours ago' },
            { level: 'info', icon: 'üîµ', title: 'API Update', message: 'Moltbook API is back online after timeout', time: '3 hours ago' }
        ];

        // Load from localStorage
        function loadTasks() {
            const stored = localStorage.getItem('jarvis_tasks');
            if (stored) {
                tasks = JSON.parse(stored);
            } else {
                // Default sample tasks
                tasks = [
                    { id: 1, title: 'Review market analysis', description: 'Check Polymarket trends', category: 'üí∞ Markets', column: 'todo', createdAt: Date.now() },
                    { id: 2, title: 'Update documentation', description: 'Add new skills to README', category: '‚úçÔ∏è Writing', column: 'todo', createdAt: Date.now() },
                    { id: 3, title: 'Security audit', description: 'Run security-audit skill', category: 'üîß Technical', column: 'completed', createdAt: Date.now() },
                    { id: 4, title: 'Send morning report', description: 'Daily market brief', category: 'üìÖ Reminders', column: 'scheduled', scheduledFor: '2026-02-24T09:00', createdAt: Date.now() }
                ];
                saveTasks();
            }
        }

        function saveTasks() {
            localStorage.setItem('jarvis_tasks', JSON.stringify(tasks));
        }

        // Navigation
        function toggleSidebar() {
            sidebarOpen = !sidebarOpen;
            document.getElementById('leftSidebar').classList.toggle('expanded', sidebarOpen);
        }

        function showPage(page) {
            currentPage = page;
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.page === page);
            });
            document.querySelectorAll('.page').forEach(p => {
                p.classList.toggle('active', p.id === 'page-' + page);
            });

            const titles = {
                dashboard: 'ü§ñ Jarvis Mission Control',
                tasks: 'üìã Task Board',
                crons: '‚è∞ Cron Jobs',
                usage: 'üí∞ Usage & Analytics',
                alerts: 'üö® Alerts',
                categories: 'üìà Categories'
            };
            document.getElementById('pageTitle').textContent = titles[page] || 'Jarvis';
        }

        function toggleChat() {
            chatOpen = !chatOpen;
            document.getElementById('rightSidebar').classList.toggle('expanded', chatOpen);
            if (chatOpen) {
                document.getElementById('chatInput').focus();
            }
        }

        // Task Management
        function renderTasks() {
            const columns = {
                scheduled: document.getElementById('scheduledTasks'),
                todo: document.getElementById('todoTasks'),
                completed: document.getElementById('completedTasks')
            };

            Object.keys(columns).forEach(col => {
                const columnTasks = tasks.filter(t => t.column === col);
                document.getElementById(col + 'Count').textContent = columnTasks.length;

                columns[col].innerHTML = columnTasks.length === 0
                    ? '<div class="empty-state"><div class="icon">üì≠</div></div>'
                    : columnTasks.map(task => `
                        <div class="task-card ${task.column}"
                             draggable="true"
                             ondragstart="handleDragStart(event, ${task.id})"
                             ondragend="handleDragEnd(event)">
                            <div class="task-title">${task.title}</div>
                            ${task.description ? `<div style="font-size: 0.7rem; color: #64748b; margin-bottom: 0.5rem;">${task.description.substring(0, 50)}${task.description.length > 50 ? '...' : ''}</div>` : ''}
                            <div class="task-meta">
                                <span class="task-category">${task.category}</span>
                                ${task.scheduledFor ? `<span>üïê ${new Date(task.scheduledFor).toLocaleString()}</span>` : ''}
                                <span>${new Date(task.createdAt).toLocaleDateString()}</span>
                                <span class="task-delete" onclick="deleteTask(${task.id})">‚úï</span>
                            </div>
                        </div>
                    `).join('');
            });
        }

        function handleDragStart(e, taskId) {
            draggedTask = taskId;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.board-column').forEach(col => {
                col.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDrop(e, targetColumn) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');

            if (draggedTask) {
                const task = tasks.find(t => t.id === draggedTask);
                if (task) {
                    // If dropping to scheduled, show schedule modal
                    if (targetColumn === 'scheduled' && task.column !== 'scheduled') {
                        openScheduleModal(task.id, targetColumn);
                    } else {
                        task.column = targetColumn;
                        if (targetColumn === 'completed') {
                            task.completedAt = Date.now();
                        }
                        saveTasks();
                        renderTasks();
                    }
                }
                draggedTask = null;
            }
        }

        function openTaskModal(column) {
            document.getElementById('taskModalTitle').textContent = column === 'scheduled' ? 'Schedule Task' : 'Add Task';
            document.getElementById('taskColumn').value = column;
            document.getElementById('scheduleGroup').style.display = column === 'scheduled' ? 'block' : 'none';
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskCategory').value = 'üí¨ Conversation';
            document.getElementById('taskSchedule').value = '';
            document.getElementById('taskModal').classList.add('active');
        }

        function openScheduleModal(taskId, targetColumn) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            document.getElementById('taskModalTitle').textContent = 'Schedule Task';
            document.getElementById('taskColumn').value = targetColumn;
            document.getElementById('scheduleGroup').style.display = 'block';
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description || '';
            document.getElementById('taskCategory').value = task.category;
            document.getElementById('taskSchedule').value = '';

            // Store the task ID for updating
            document.getElementById('taskModal').dataset.taskId = taskId;

            document.getElementById('taskModal').classList.add('active');
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.remove('active');
            delete document.getElementById('taskModal').dataset.taskId;
        }

        function saveTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const category = document.getElementById('taskCategory').value;
            const column = document.getElementById('taskColumn').value;
            const scheduledFor = document.getElementById('taskSchedule').value;
            const existingTaskId = document.getElementById('taskModal').dataset.taskId;

            if (!title) {
                alert('Please enter a task title');
                return;
            }

            if (existingTaskId) {
                // Update existing task
                const task = tasks.find(t => t.id === parseInt(existingTaskId));
                if (task) {
                    task.title = title;
                    task.description = description;
                    task.category = category;
                    task.column = column;
                    if (scheduledFor) {
                        task.scheduledFor = scheduledFor;
                    }
                }
            } else {
                // Create new task
                const newTask = {
                    id: Date.now(),
                    title,
                    description,
                    category,
                    column,
                    createdAt: Date.now()
                };
                if (scheduledFor) {
                    newTask.scheduledFor = scheduledFor;
                }
                tasks.push(newTask);
            }

            saveTasks();
            renderTasks();
            closeTaskModal();
        }

        function deleteTask(taskId) {
            if (confirm('Delete this task?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                saveTasks();
                renderTasks();
            }
        }

        // Cron Details
        function renderCrons() {
            document.getElementById('cronList').innerHTML = cronJobs.map(cron => `
                <div class="cron-item" onclick="openCronModal('${cron.id}')">
                    <span class="cron-icon">${cron.icon}</span>
                    <div class="cron-info">
                        <div class="cron-name">${cron.name}</div>
                        <div class="cron-schedule">${cron.schedule}</div>
                    </div>
                    <span class="cron-status ${cron.status}">${cron.status}</span>
                </div>
            `).join('');
            document.getElementById('cronBadge').textContent = `${cronJobs.length} Active`;
        }

        function openCronModal(cronId) {
            const cron = cronJobs.find(c => c.id === cronId);
            if (!cron) return;

            document.getElementById('cronModalTitle').textContent = cron.name;
            document.getElementById('cronModalBody').innerHTML = `
                <div style="margin-bottom: 1.5rem;">
                    <div style="font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; margin-bottom: 0.5rem;">Schedule</div>
                    <div style="font-size: 0.9rem; color: #e2e8f0;">${cron.schedule}</div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <div style="font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; margin-bottom: 0.5rem;">Status</div>
                    <span class="cron-status ${cron.status}">${cron.status.toUpperCase()}</span>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <div style="font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; margin-bottom: 0.5rem;">Prompt / Instructions</div>
                    <div style="background: #1e293b; padding: 1rem; border-radius: 6px; font-size: 0.8rem; line-height: 1.5; color: #e2e8f0;">${cron.prompt}</div>
                </div>

                <div>
                    <div style="font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; margin-bottom: 0.5rem;">Run History</div>
                    ${cron.history.map(h => `
                        <div class="cron-history-item">
                            <div class="cron-history-time">${h.time}</div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                <span class="cron-history-status ${h.status}">${h.status.toUpperCase()}</span>
                                <span style="color: #64748b;">${h.duration}</span>
                            </div>
                            <div style="color: #e2e8f0;">${h.result}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('cronModal').classList.add('active');
        }

        function closeCronModal() {
            document.getElementById('cronModal').classList.remove('active');
        }

        // Usage Analytics
        function renderUsage() {
            const totalTokens = modelUsage.reduce((sum, m) => sum + m.tokens, 0);
            const totalRequests = modelUsage.reduce((sum, m) => sum + m.requests, 0);
            const totalCost = modelUsage.reduce((sum, m) => sum + (m.tokens * m.cost), 0);

            document.getElementById('totalTokens').textContent = totalTokens.toLocaleString();
            document.getElementById('estimatedCost').textContent = '$' + totalCost.toFixed(2);

            // Model usage table
            const maxTokens = Math.max(...modelUsage.map(m => m.tokens));
            document.getElementById('modelUsageTable').querySelector('tbody').innerHTML = modelUsage.map(m => {
                const pct = totalTokens > 0 ? ((m.tokens / totalTokens) * 100).toFixed(1) : 0;
                const avgTokens = m.requests > 0 ? Math.round(m.tokens / m.requests) : 0;
                return `
                    <tr>
                        <td>
                            <div style="font-weight: 600;">${m.model}</div>
                            <div style="font-size: 0.65rem; color: #64748b;">${m.provider}</div>
                        </td>
                        <td>${m.tokens.toLocaleString()}</td>
                        <td>${m.requests}</td>
                        <td>${pct}%</td>
                        <td>${avgTokens}</td>
                    </tr>
                `;
            }).join('');

            // Time distribution
            const timeData = Array(24).fill(0).map(() => ({ hour: 0, tokens: 0 }));
            modelUsage.forEach((m, i) => {
                const hour = (i * 6) % 24; // Mock distribution
                timeData[hour].hour = hour;
                timeData[hour].tokens += Math.floor(m.tokens / 4);
            });
            const maxTimeTokens = Math.max(...timeData.map(t => t.tokens));
            document.getElementById('usageByHour').innerHTML = timeData.map(t => {
                const height = maxTimeTokens > 0 ? (t.tokens / maxTimeTokens) * 100 : 0;
                const hourLabel = t.hour % 12 || 12;
                const ampm = t.hour >= 12 ? 'PM' : 'AM';
                return `
                    <div class="time-dist-bar" style="height: ${Math.max(height, 4)}%; background: ${t.tokens > 0 ? '#3b82f6' : '#1f2937'};"
                         data-hour="${hourLabel}${ampm}"></div>
                `;
            }).join('');
        }

        // Alerts
        function renderAlerts() {
            document.getElementById('alertCount').textContent = alerts.length;

            const renderAlert = (a) => `
                <div class="alert-item ${a.level}">
                    <span style="font-size: 1.25rem;">${a.icon}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.85rem;">${a.title}</div>
                        <div style="font-size: 0.75rem; color: #94a3b8; margin-top: 0.25rem;">${a.message}</div>
                        <div style="font-size: 0.65rem; color: #64748b; margin-top: 0.25rem;">${a.time}</div>
                    </div>
                </div>
            `;

            document.getElementById('recentAlerts').innerHTML = alerts.slice(0, 3).map(renderAlert).join('');
            document.getElementById('allAlertsList').innerHTML = alerts.map(renderAlert).join('');
        }

        // Categories
        function renderCategories() {
            // Mock category data
            const categories = [
                { name: 'üí¨ Conversation', count: 45, tokens: 67500, lastActive: '2 hours ago' },
                { name: 'üîß Technical', count: 38, tokens: 57000, lastActive: '1 hour ago' },
                { name: 'üí∞ Markets', count: 28, tokens: 42000, lastActive: '4 hours ago' },
                { name: 'üìà Analysis', count: 22, tokens: 33000, lastActive: '6 hours ago' },
                { name: 'üß† Research', count: 15, tokens: 22500, lastActive: '8 hours ago' },
                { name: '‚úçÔ∏è Writing', count: 12, tokens: 18000, lastActive: '12 hours ago' },
                { name: 'üìÖ Reminders', count: 8, tokens: 12000, lastActive: '23 hours ago' },
                { name: 'üè• Heartbeat', count: 5, tokens: 7500, lastActive: '3 hours ago' }
            ];

            const totalCount = categories.reduce((sum, c) => sum + c.count, 0);

            document.getElementById('categoriesTable').querySelector('tbody').innerHTML = categories.map(c => {
                const pct = totalCount > 0 ? ((c.count / totalCount) * 100).toFixed(1) : 0;
                return `
                    <tr>
                        <td>${c.name}</td>
                        <td>${c.count}</td>
                        <td>${pct}%</td>
                        <td>${c.tokens.toLocaleString()}</td>
                        <td>${c.lastActive}</td>
                    </tr>
                `;
            }).join('');

            const maxCount = Math.max(...categories.map(c => c.count));
            document.getElementById('categoryChart').innerHTML = categories.map(c => {
                const pct = maxCount > 0 ? (c.count / maxCount) * 100 : 0;
                return `
                    <div class="chart-bar-row">
                        <div class="chart-bar-label">${c.name}</div>
                        <div class="chart-bar-track">
                            <div class="chart-bar-fill" style="width: ${pct}%; background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white;">${c.count}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Dashboard
        function renderDashboard() {
            // Quick stats
            const totalRequests = tasks.length + 173; // Mock total
            const completed = tasks.filter(t => t.column === 'completed').length;
            document.getElementById('quickStats').innerHTML = `
                <div class="metric-card success">
                    <div class="metric-label">Total Requests</div>
                    <div class="metric-value">${totalRequests}</div>
                    <div class="metric-sub">All time</div>
                </div>
                <div class="metric-card ${completed === totalRequests ? 'success' : 'warning'}">
                    <div class="metric-label">Completed</div>
                    <div class="metric-value">${completed}</div>
                    <div class="metric-sub">${Math.round((completed / totalRequests) * 100)}% rate</div>
                </div>
            `;
            document.getElementById('statCount').textContent = totalRequests + ' requests';

            // Top categories
            document.getElementById('topCategories').innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span class="category-pill conversation">üí¨ Conversation</span>
                        <span style="font-size: 0.75rem; color: #94a3b8;">45 (26%)</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 100%"></div></div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span class="category-pill technical">üîß Technical</span>
                        <span style="font-size: 0.75rem; color: #94a3b8;">38 (22%)</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 84%"></div></div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span class="category-pill markets">üí∞ Markets</span>
                        <span style="font-size: 0.75rem; color: #94a3b8;">28 (16%)</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 62%"></div></div>
                </div>
            `;

            // Timeline
            document.getElementById('timeline').innerHTML = `
                <div class="timeline-item">
                    <span class="timeline-time">4:38 PM</span>
                    <span class="timeline-text">Nightly build #9 completed</span>
                </div>
                <div class="timeline-item">
                    <span class="timeline-time">9:00 AM</span>
                    <span class="timeline-text">Market report sent to Telegram</span>
                </div>
                <div class="timeline-item">
                    <span class="timeline-time">7:38 AM</span>
                    <span class="timeline-text">Moltbook API check successful</span>
                </div>
                <div class="timeline-item">
                    <span class="timeline-time">3:00 AM</span>
                    <span class="timeline-text">Auto-update ran (4m 45s)</span>
                </div>
            `;

            // Streak
            document.getElementById('streak').textContent = '7 days';

            // Time distribution chart
            const timeDistData = [0,0,0,0,0,0,0,2,5,8,12,15,18,14,10,8,6,5,4,3,2,1,0,0];
            const maxTimeDist = Math.max(...timeDistData);
            document.getElementById('timeDistChart').innerHTML = timeDistData.map((count, hour) => {
                const height = (count / maxTimeDist) * 100;
                const hourLabel = hour % 12 || 12;
                return `
                    <div class="time-dist-bar" style="height: ${Math.max(height, 4)}%; background: ${count > 0 ? '#3b82f6' : '#1f2937'};"
                         data-hour="${hourLabel}"></div>
                `;
            }).join('');

            // Recent alerts
            document.getElementById('recentAlerts').innerHTML = alerts.slice(0, 3).map(a => `
                <div class="alert-item ${a.level}">
                    <span>${a.icon}</span>
                    <div>
                        <div style="font-size: 0.8rem; font-weight: 600;">${a.title}</div>
                        <div style="font-size: 0.7rem; color: #94a3b8;">${a.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // Chat
        function handleChatKeypress(e) {
            if (e.key === 'Enter') sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;

            addMessage('user', text);
            input.value = '';

            // Simulate Jarvis response
            setTimeout(() => {
                const responses = [
                    "Got it! I'll add that to the task board.",
                    "Working on it now. Should be done shortly.",
                    "I've scheduled that for you.",
                    "On it! üëç",
                    "Let me check the cron history for you.",
                    "Updating the dashboard with the latest data..."
                ];
                addMessage('jarvis', responses[Math.floor(Math.random() * responses.length)]);
            }, 1000);
        }

        function addMessage(type, text) {
            const container = document.getElementById('chatMessages');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.innerHTML = `
                <div class="message-avatar">${type === 'jarvis' ? 'ü§ñ' : 'üë§'}</div>
                <div class="message-content">
                    ${text}
                    <div class="message-time">${new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit'})}</div>
                </div>
            `;
            container.appendChild(message);
            container.scrollTop = container.scrollHeight;
        }

        // Init
        function init() {
            document.getElementById('currentDate').textContent =
                new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });

            loadTasks();
            renderTasks();
            renderCrons();
            renderUsage();
            renderAlerts();
            renderCategories();
            renderDashboard();

            setInterval(() => {
                // Auto-refresh data
                renderDashboard();
            }, 30000);
        }

        init();
    </script>
</body>
</html>
